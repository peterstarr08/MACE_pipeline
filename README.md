# File naming convention

Syntax: 
```
[label]__[$type]__[$operation].[extension]
```
`[...]` is defined as a single block. Users can only control `[label]`. Blocks like `[$...]` are generated by program.

Each `[...]` is underscore `_` separated values. And each block are separted by double underscore `__` 

## Block position:
 - **Index 0**: Information about sample. Possible values for `[label]`: `benzene_mix_10`, `methanol_mix_20`, `benzene_mix_10_cutoff`,`benzene_mix_10_ind`.

 - **Index 1**: Information about what type of file is. Exhaustive possible values for `[$type]`: `raw_dataset` for labelling raw data, `dataset` for processed data. Will keep updating this
 - **Index 2**: Information about what operation was done on that file recently. Exhaustive possible values for `[$operation]`: `xtb` for labelling xtb calculated configs. Will keep updating this


## [Dataset directory](https://tree.nathanfriend.com/?s=(%27options!(%27fancy!true~fullPath!false~TlingSlash!true~rootDot!false)~W(%27W%27MACE_PIPELINEG*qR-Fd7Y6-Z67K-4H7U*G8K-8H7GUmixG*RJFd_TnXBQ9*Fd_OXlabelledQjKJ4H9*4Hj-G8KJ8H9*8Hj%27)~version!%271%27)*%20%20-GU*3XBXcp2kV4Ubenzene6cutoff7XqBV8Umethanol9_Tn3-UO-BdatasetFZinG%5CnH_50_6J-UTnYK-50Y6OtestQXxtbVYFtRBG4-10YindTtraiU**V.xyzWsource!X__Y-*Z4_10_j_O3qraw_%01qjZYXWVUTRQOKJHGFB987643-*)

`[$type]` defines files directory from project root. `[label]` splits `_` to path directory

```
MACE_PIPELINE/
├── raw_dataset/
│   ├── benzene/
│   │   ├── 10/
│   │   │   ├── ind/
│   │   │   │   └── benzene_10_ind__raw_dataset.xyz
│   │   │   └── cutoff/
│   │   │       └── benzene_10_cutoff__raw_dataset.xyz
│   │   └── 50/
│   │       └── cutoff/
│   │           └── benzene_50_cutoff__raw_dataset.xyz      
│   ├── methanol/
│   │   └── 50/
│   │       └── cutoff/
│   │           └── methanol_50_cutoff__raw_dataset.xyz
│   └── mix
└── dataset/
    ├── benzene/
    │   ├── 10/
    │   │   └── ind/
    │   │       ├── train/
    │   │       │   ├── benzene_10_ind_train__dataset__xtb.xyz
    │   │       │   └── benzene_10_int_train__dataset__cp2k.xyz
    │   │       └── test/
    │   │           ├── benzene_10_ind_test__labelled__xtb.xyz
    │   │           └── benzene_10_int_test__dataset__cp2k.xyz
    │   └── 50/
    │       └── cutoff/
    │           ├── train/
    │           │   └── benzene_50_cutoff_train__dataset__cp2k.xyz
    │           └── test/
    │               └── benzene_50_cutoff_test__dataset__cp2k.xyz
    └── methanol/
        └── 50/
            └── cutoff/
                ├── train/
                │   └── methanol_50_cutoff_train__dataset__cp2k.xyz
                └── test/
                    └── methanol_50_cutoff_test__dataset__cp2k.xyz
```

## [Active learning directory](https://tree.nathanfriend.com/?s=(%27options!(%27fancy!true~fullPath!false~trailingSlash!true~rootDot!false)~source!(%27source!%27MACE_PIPELINE%5Cn7Z4Z0W4Z1W%5Cn7X4benzene47cutT10T7train-XVwH**9testT*J_testVXVwH**%209Q1%2F-w6H-w6VF1H-w6VF2HT*Y-cp2k6H-cp2k6VF1H-cp2k6VF2HT7Q2%2F-wVQ2GH-wVQ2GVF1HT*Y%5Cn7models4J%25maceTQ_0V51WTQ_0V52WTQ_1V51WTY%25openmm%3ATQ_0VopenmmV51q1K*Q_1VopenmmV52q2K7Q_0TtrajTR58R58R%22851B52B53BYT%221B%222BY47Q_1T51B52B53.modellTYTY47gem_2TY47Y%27)~version!%271%27)*77-T*J_trainV4%5Cn*5F1_comm6VQ1G7%20%208T*%3COpenMM%20files%3ET9%23%20Q%200%3A%20original%20train%20XT7B.modelTFmace0G_%5B%24count%5DH.xyzJbenzene_cut_10K%20to%20do%20a%20md%20run4QgenR7%5Blabel%5D_T4*V__W.ymlXdatasetY...ZpipelineqW**%23Uses%205wxtb%22F2_comm%2547configs_%01%25%22wqZYXWVTRQKJHGFB987654-*) | Single job queue with only 1 md run

```
MACE_PIPELINE/
├── pipeline/
│   ├── pipeline0.yml
│   └── pipeline1.yml
├── dataset/
│   └── benzene/
│       └── cut/
│           └── 10/
│               ├── train/
│               │   └── benzene_cut_10_train__dataset__xtb.xyz        # gen 0: original train dataset
│               ├── test/
│               │   └── benzene_cut_10_test__dataset__xtb.xyz         # gen 0: original train dataset
│               ├── gen1/
│               │   ├── benzene_cut_10_train__xtb__gen1_[$count].xyz
│               │   ├── benzene_cut_10_train__xtb__gen1_[$count]__mace01.xyz
│               │   ├── benzene_cut_10_train__xtb__gen1_[$count]__mace02.xyz
│               │   ├── ...
│               │   ├── benzene_cut_10_train__cp2k__gen1_[$count].xyz
│               │   ├── benzene_cut_10_train__cp2k__gen1_[$count]__mace01.xyz
│               │   └── benzene_cut_10_train__cp2k__gen1_[$count]__mace02.xyz
│               └── gen2/
│                   ├── benzene_cut_10_train__xtb__gen2_[$count].xyz
│                   ├── benzene_cut_10_train__xtb__gen2_[$count]__mace01.xyz
│                   └── ...
└── models/
    └── benzene_cut_10/
        ├── configs_mace/
        │   ├── gen_0__mace01_comm1.yml
        │   ├── gen_0__mace01_comm2.yml
        │   ├── gen_1__mace01_comm1.yml
        │   └── ...
        ├── configs_openmm:/
        │   ├── gen_0__openmm__mace01_comm1.yml        #Uses mace01_comm1 to do a md run
        │   └── gen_1__openmm__mace01_comm2.yml        #Uses mace01_comm2 to do a md run
        ├── gen_0/
        │   ├── traj/
        │   │   ├── [label]_mace01_comm/
        │   │   │   └── <OpenMM files>
        │   │   ├── [label]_mace01_comm/
        │   │   │   └── <OpenMM files>
        │   │   └── [label]_mace02_comm/
        │   │       └── <OpenMM files>
        │   ├── mace01_comm1.model
        │   ├── mace01_comm2.model
        │   ├── mace01_comm3.model
        │   ├── ...
        │   ├── mace02_comm1.model
        │   ├── mace02_comm2.model
        │   └── ...
        ├── gen_1/
        │   ├── mace01_comm1.model
        │   ├── mace01_comm2.model
        │   ├── mace01_comm3.modell
        │   ├── ...
        │   └── ...
        ├── gem_2/
        │   └── ...
        └── ...
```

#### Directory Conventions
>MACE models: `root/models/[label]/gen[n]/mace[model].<ext>` \
MD Trajectories: `root/models/[label]/gen[n]/traj/[<label>]_mace[model]/[$openmm_files]`\
Gen[n] Dataset: `root/dataset/[label.path]/gen[n]/[label]_train__[operation]__gen[n]_[frames_count]__[mace_model].xyz`

**Note `[mace_model]` is just mace version not committee name, since it doesn't makes sense ot name it from committee name**

### Explanation of pipeline execution

`pipeline_sample.yml`
```
pipeline:
	- gen0:
		models_path:
			- root/models/[label]/configs_mace/gen_0__mace01_comm1.yml
			- root/models/[label]/configs_mace/gen_0__mace01_comm2.yml
		md_path:
			- root/models/[label]/configs_openmm/gen_0__openmm.yml
		new_dataset_path:
			- root/dataset/*/[label]_[operation]__gen1__$[count]__mace01.xyz
	- gen1:
		...
```

The `mario.py` cli receives input `pipeline.yml`'s path to flag `--pipeline`. The pipeline config contains array of `gen[n]` entries in `pipeline` key. For example: `config.pipeline = [gen0, gen1, gen2, gen3]`. Each `gen[n]` contains three entries specifiying location of `config` files, in order, for`mace model, md openmm, and location for saving generated new daatset. Above is recommended structure for file handling. Program currently doesn't handles this autmatically.

`mario.py` runs a `files_exists` check on all of these files before execution. The internal modules doesn't check for existence of input file. For example, MACE model config when executing the package itself will throw error if any input files ddoesn't exist. Both `mace-torch` & `mace-openmm` creates required directly themselves.

